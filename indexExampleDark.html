<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<script type="text/javascript" src="vendor/d3-3.4.3/d3.js"></script>
<script type="text/javascript" src="vendor/angular-1.2.14/angular.js"></script>
<script type="text/javascript" src="ivml/ivml.js"></script>
<script type="text/javascript" src="ivml/elements/plot.js"></script>
<script type="text/javascript" src="ivml/elements/points.js"></script>
<script type="text/javascript" src="ivml/elements/rectangles.js"></script>
<script type="text/javascript" src="ivml/elements/paths.js"></script>
<script type="text/javascript" src="ivml/elements/line-group.js"></script>
<script type="text/javascript" src="ivml/elements/cylinders.js"></script>


<style>
    body {
        background: #4B4B4B;
    }
</style>

<body>
<div ng-app="ivmlexample">
    <div ng-controller="mainCtrl">
        <plot height="75" width="400" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xodomain="xOrdinals" yticks="5" ymin="0" ymax="10"
              background="'#4B4B4B'"
              xaxis-font-color="'#c9c9c9'" xaxis-font-size="11" xaxis-stroke="'#c9c9c9'"
              yaxis-font-color="'#c9c9c9'" yaxis-font-size="11" yaxis-stroke="'#c9c9c9'"
              margin-bottom="30" margin-left="30" xbrush="zoomBrushOrdinalHorizontal"
              plot-label-text="'Zoom'" plot-label-font-color="'#c9c9c9'" plot-label-font-size="'16px'">

            <points data="ordinalData" xfunction="'/0'" yfunction="'/1'" stroke="'steelblue'" fill="'steelblue'"
                    fill-opacity="'1'" radius="5"></points>
            <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                   stroke="'steelblue'"></paths>
        </plot>
        <br>
        <plot height="150" width="800" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xodomain="zxOrdinals" xticks="13" ymin="0" ymax="10"
              background="'#4B4B4B'"
              xaxis-font-color="'#c9c9c9'" xaxis-font-size="11" xaxis-stroke="'#c9c9c9'"
              yaxis-font-color="'#c9c9c9'" yaxis-font-size="11" yaxis-stroke="'#c9c9c9'"
              margin-bottom="30" margin-left="30">
            <!--<bar-group type="'stacked'">-->
            <!--<bars data="ordinalData" position-function="'/0'" value-function="'/1'" fill="'steelblue'"></bars>-->
            <!--<bars data="ordinalData" position-function="'/0'" value-function="'/1'" fill="'red'"></bars>-->
            <!--</bar-group>-->

            <points data="ordinalData" xfunction="'/0'" yfunction="'/1'" stroke="'#FF8C00'" fill="'#FFBC8D'"
                    fill-opacity="'0.7'" radius="6"></points>
            <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'" stroke="'#6A7D3C'"
                   stroke-dasharray="'5, 5'"></paths>
        </plot>
        <br>
        <plot height="150" width="800" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xodomain="zxOrdinals" xticks="13" ymin="0" ymax="10"
              background="'#4B4B4B'"
              xaxis-font-color="'#c9c9c9'" xaxis-font-size="11" xaxis-stroke="'#c9c9c9'"
              yaxis-font-color="'#c9c9c9'" yaxis-font-size="11" yaxis-stroke="'#c9c9c9'"
              margin-top="10" margin-bottom="30" margin-left="30">
            <line-group>
                <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#FF725E'" stroke-opacity="0.2"
                       fill="'#fda7ae'" fill-opacity="0.2"></paths>
                <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#00FF00'" stroke-opacity="0.2"
                       fill="'#A5FD8E'" fill-opacity="0.2"></paths>
            </line-group>

            <rectangles data="ordinalData" xcenter-function="'/0'" ycenter-function="'/1'" stroke="'#FF0000'"
                        fill="'none'"
                        fill-opacity="'0.9'" height="15" width="15"></rectangles>

            <cylinders data="ordinalData" centerxfunction="'/0'" centeryfunction="'/1'" stroke="'#808080'"
                       fill="'steelblue'"
                       fill-opacity="'0.9'" height="8" width="15"></cylinders>
        </plot>
    </div>

</div>
</div>
<script type="text/javascript">
    angular.module("ivmlexample", ['ivml'])
            .controller("mainCtrl", function ($scope) {
                var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
                $scope.xOrdinals = d3.range(characters.length).map(function (d) {
                    return characters.charAt(d)
                });

                $scope.donutData = [
                    {
                        s: [1, 2, 3, 4],
                        x: 4,
                        y: 4
                    },
                    {
                        s: [1, 2, 3, 4],
                        x: 7,
                        y: 7
                    }
                ]

                $scope.funct0 = function (d, i) {
                    return d[0];
                }

                $scope.funcSelf = function (d) {
                    return d;
                }

                $scope.zoomBrushOrdinalHorizontal = function (brush) {
                    $scope.$apply(function ($scope) {
                        if (brush.empty()) {
                            $scope.zxOrdinals = $scope.xOrdinals;
                        }
                        else {
                            var e = brush.extent();
                            var xs = brush.x();
                            var push = xs.rangeBand ? xs.rangeBand() / 2 : 0;

                            $scope.zxOrdinals = $scope.xOrdinals.filter(function (d) {
                                var x = xs(d) + push;
                                return e[0] <= x && x <= e[1];
                            });
                        }
                    });
                };

                $scope.segmentdata = [
                    {
                        x1: 3,
                        y1: 3,
                        x2: 7,
                        y2: 7,
                        h: 9,
                        w: 7

                    }
                ]

                $scope.getHeight = function (d) {
                    return d.h;
                }
                $scope.getWidth = function (d) {
                    return d.w;
                }

                $scope.getX = function (d) {
                    return d[0];
                };
                $scope.getY = function (d) {
                    return d[1];
                };
                $scope.getR = function (d) {
                    return (d[0] + d[1]) / 2 + 1;
                };

                function randBetween(start, end) {
                    return Math.round(Math.random() * (end - start)) + start;
                }

                function get5Randoms() {
                    var rtrn = [];
                    for (var i = 0; i < 5; i++) {
                        var r = randBetween(0, 10);
                        while (rtrn.indexOf(r) >= 0) {
                            r = randBetween(0, 10);
                        }
                        rtrn.push(r);
                    }
                    return rtrn;
                }

                function merge(rA, rB) {
                    return rA
                            .map(function (d, i) {
                                return [d, rB[i]];
                            })
                            .sort(function (a, b) {
                                return a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0;
                            });
                }

                $scope.perturbate = function () {
                    $scope.ordinalStack1 = [
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 2)];
                        }),
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 3)];
                        })
                    ];

                    $scope.ordinalStack2 = [
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 2)];
                        }),
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 3)];
                        })
                    ];

                    $scope.ordinalData = $scope.xOrdinals.map(function (d, i) {
                        return [d, ($scope.ordinalStack1[0][i][1] + $scope.ordinalStack1[1][i][1] + $scope.ordinalStack2[0][i][1] + $scope.ordinalStack2[1][i][1]) / 2];
                    });

                    $scope.points = merge(get5Randoms(), get5Randoms());
                    $scope.points2 = merge(get5Randoms(), get5Randoms());
                    $scope.points3 = merge(get5Randoms(), get5Randoms());

                    $scope.lineData = [$scope.points];
                    $scope.lineData2 = [$scope.points2];
                    $scope.lineData3 = [$scope.points3];

                    $scope.xmin = Math.min(d3.min($scope.lineData[0], $scope.getX), d3.min($scope.lineData2[0], $scope.getX), d3.min($scope.lineData3[0], $scope.getX));
                    $scope.xmax = Math.max(d3.max($scope.lineData[0], $scope.getX), d3.max($scope.lineData2[0], $scope.getX), d3.max($scope.lineData3[0], $scope.getX));

                    $scope.ymax = d3.max($scope.lineData[0], $scope.getY) + d3.max($scope.lineData2[0], $scope.getY) + d3.max($scope.lineData3[0], $scope.getY);
                    $scope.ymin = 0;//d3.min($scope.lineData[0], $scope.getY) + d3.min($scope.lineData2[0], $scope.getY) + d3.min($scope.lineData3[0], $scope.getY);

                    var size_of_donut = Math.round(randBetween(1, 10));

                    $scope.donutData = [];
                    for (var i = 0; i < size_of_donut; ++i) {
                        var slices = Math.round(randBetween(1, 20));
                        var d = [];
                        for (var j = 0; j < slices; ++j) {
                            d.push(Math.random());
                        }
                        $scope.donutData.push({
                            x: randBetween(1, 15),
                            y: randBetween(1, 15),
                            s: d
                        })

                    }
                };

                $scope.zoomBrushContinuous = function (brush, controller) {
                    $scope.$apply(function ($scope) {
                        var e = brush.extent();
                        if (e[0][0] === e[1][0] || e[0][1] === e[1][1]) {
                            $scope.zxmin = $scope.xmin;
                            $scope.zxmax = $scope.xmax;
                            $scope.zymin = $scope.ymin;
                            $scope.zymax = $scope.ymax;
                        }
                        else {
                            $scope.zxmin = e[0][0];
                            $scope.zxmax = e[1][0];
                            $scope.zymin = e[0][1];
                            $scope.zymax = e[1][1];
                        }
                    });
                };

                $scope.perturbate();
                $scope.zxmin = $scope.xmin;
                $scope.zxmax = $scope.xmax;
                $scope.zymin = $scope.ymin;
                $scope.zymax = $scope.ymax;
                $scope.zxOrdinals = $scope.xOrdinals;
            });
</script>
</body>
</html>
