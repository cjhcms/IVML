<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<script type="text/javascript" src="vendor/d3-3.4.3/d3.js"></script>
<script type="text/javascript" src="vendor/angular-1.2.14/angular.js"></script>
<script type="text/javascript" src="dist/ivml.0.0.0.js"></script>

<body>
<div ng-app="ivmlexample">
    <div ng-controller="mainCtrl">
        <div style="float:left">
            <input type="button" ng-click="perturbate()" value="Randomize"/>

            <plot height="100" width="300" plot-label-text="'Zoom'" yaxis-label-text="'y-values'"
                  xaxis-label-text="'x-values'" xodomain="xOrdinals" yticks="5" ymin="0" ymax="5"
                  xbrush="zoomBrushOrdinalHorizontal">
                <points data="ordinalData" xfunction="'/0'" yfunction="'/1'" stroke="'#FF8C00'" fill="'#FFBC8D'"
                        fill-opacity="'0.5'" radius="5"></points>
                <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#4682B4'"
                       stroke-dasharray="'5, 5'"></paths>
            </plot>
        </div>

        <plot style="float:left" height="200" width="500" plot-label-text="'Ordinal Axis'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xodomain="zxOrdinals" xticks="13" ymin="zOrdMinY" ymax="zOrdMaxY">
            <line-group>
                <paths data="ordinalStack1" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#FF725E'" stroke-opacity="0.2"
                       fill="'#fda7ae'" fill-opacity="0.2"></paths>
                <paths data="ordinalStack2" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#00FF00'" stroke-opacity="0.2"
                       fill="'#A5FD8E'" fill-opacity="0.2"></paths>
            </line-group>

            <bar-group type="grouped">
                <bars data="ordinalData" position-function="'/0'" value-function="'/1'" thickness="'5'"></bars>
            </bar-group>

            <points data="ordinalData" xfunction="'/0'" yfunction="'/1'" stroke="'#FF8C00'" fill="'#FFBC8D'"
                    fill-opacity="'0.5'" radius="5"></points>
            <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'" stroke="'#4682B4'"
                   stroke-dasharray="'5, 5'"></paths>
        </plot>

        <div style="clear:both"></div>

        <plot style="float:left" height="200" width="200" plot-label-text="'Zoom'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xticks="5" yticks="5" xmin="xmin" xmax="xmax" ymin="ymin" ymax="ymax"
              brush="zoomBrushContinuous">
            <paths data="lineData" points-function="funcSelf" xfunction="getX" yfunction="getY"
                   stroke="'#0000FF'"></paths>
            <paths data="lineData2" points-function="funcSelf" xfunction="getX" yfunction="getY"
                   stroke="'#FF725E'"></paths>
            <paths data="lineData3" points-function="funcSelf" xfunction="getX" yfunction="getY"
                   stroke="'#00FF00'"></paths>
        </plot>

        <plot style="float:left" height="400" width="400" plot-label-text="'Lines'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xmin="zxmin" xmax="zxmax" ymin="zymin" ymax="zymax"
              zoom-extent="zoomExtentContinuous">
            <paths data="lineData" points-function="funcSelf" xfunction="getX" yfunction="getY" stroke="'#0000FF'"
                   stroke-dasharray="'5, 5'"></paths>
            <paths data="lineData2" points-function="funcSelf" xfunction="getX" yfunction="getY"
                   stroke="'#FF725E'"></paths>
            <paths data="lineData3" points-function="funcSelf" xfunction="getX" yfunction="getY"
                   stroke="'#00FF00'"></paths>
        </plot>

        <plot style="float:left" height="400" width="400" plot-label-text="'Stacked Area'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xmin="zxmin" xmax="zxmax" ymin="zymin" ymax="zymax"
              zoom-extent="zoomExtentContinuous">
            <line-group>
                <paths data="lineData" points-function="funcSelf" xfunction="getX" yfunction="getY" stroke="'#0000FF'"
                       fill="'#aaebfd'"></paths>
                <paths data="lineData2" points-function="funcSelf" xfunction="getX" yfunction="getY" stroke="'#FF725E'"
                       fill="'#fda7ae'"></paths>
                <paths data="lineData3" points-function="funcSelf" xfunction="getX" yfunction="getY" stroke="'#00FF00'"
                       fill="'#A5FD8E'"></paths>
            </line-group>
        </plot>

        <plot style="float:left" height="400" width="400" plot-label-text="'Points'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xmin="zxmin" xmax="zxmax" ymin="zymin" ymax="zymax"
              zoom-extent="zoomExtentContinuous">
            <points data="points" xfunction="'/0'" yfunction="'/1'" stroke="'#0000FF'" fill="'#aaebfd'"
                    fill-opacity="'0.5'" radius="getR" stroke-dasharray="'5, 5'"></points>
            <points data="points2" xfunction="'/0'" yfunction="'/1'" stroke="'#FF725E'" fill="'#fda7ae'"
                    fill-opacity="'0.5'" radius="getR"></points>
            <points data="points3" xfunction="'/0'" yfunction="'/1'" stroke="'#00FF00'" fill="'#A5FD8E'"
                    fill-opacity="'0.5'" radius="getR"></points>
            <texts data="points3" xfunction="'/0'" yfunction="'/1'" text-function="'/0'"></texts>

            <rectangles data="points2" xcenter-function="'/0'" ycenter-function="'/1'" width="'7'"
                        height="'6'"></rectangles>

            <line-segments data="segmentdata" x1-function="'/x1'" y1-function="'/y1'" x2-function="'/x2'"
                           y2-function="'/y2'" stroke="'gray'" stroke-opacity="0.3"
                           stroke-dasharray="'3,3'"></line-segments>
            <error-bars data="segmentdata" xcenter-function="'/x1'" ycenter-function="'/y1'" up-function="'/x2'"
                        right-function="'/y2'"></error-bars>
        </plot>

        <plot style="float:left" height="400" width="400" plot-label-text="'Points'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xmin="zxmin" xmax="zxmax" ymin="zymin" ymax="zymax"
              zoom-extent="zoomExtentContinuous">

            <donut-charts data="donutData" xfunction="'/x'" yfunction="'/y'" slice-function="'/s'"
                          inner-radius="'3'"></donut-charts>

        </plot>


        <plot style="float:left" height="200" width="500" plot-label-text="'Ordinal Axis'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" xodomain="zxOrdinals" xticks="13" ymin="zOrdMinY" ymax="zOrdMaxY">
            <bar-group type="'stacked'">
                <bars data="ordinalData" position-function="'/0'" value-function="'/1'" fill="'steelblue'"></bars>
                <bars data="ordinalData" position-function="'/0'" value-function="'/1'" fill="'red'"></bars>

            </bar-group>

            <points data="ordinalData" xfunction="'/0'" yfunction="'/1'" stroke="'#FF8C00'" fill="'#FFBC8D'"
                    fill-opacity="'0.5'" radius="5"></points>
            <paths data="[ordinalData]" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'" stroke="'#4682B4'"
                   stroke-dasharray="'5, 5'"></paths>

        </plot>

        <plot style="float:left" height="800" width="500" plot-label-text="'Ordinal Axis'" yaxis-label-text="'y-values'"
              xaxis-label-text="'x-values'" yodomain="zxOrdinals" xticks="13" xmin="zOrdMinY" xmax="zOrdMaxY">
            <bar-group type="'stacked'" arrangement="'horizontal'">


                <bars data="ordinalData" position-function="'/0'" value-function="'/1'" fill="'steelblue'"></bars>
                <bars data="ordinalData" position-function="'/0'" value-function="'/1'" fill="'red'"></bars>

            </bar-group>


            <line-group>
                <paths data="ordinalStack1" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#FF725E'" stroke-opacity="0.2"
                       fill="'#fda7ae'" fill-opacity="0.2"></paths>
                <paths data="ordinalStack2" points-function="funcSelf" xfunction="'/0'" yfunction="'/1'"
                       stroke="'#00FF00'" stroke-opacity="0.2"
                       fill="'#A5FD8E'" fill-opacity="0.2"></paths>
            </line-group>
        </plot>

    </div>


</div>
</div>
<script type="text/javascript">
    angular.module("ivmlexample", ['ivml'])
            .controller("mainCtrl", function ($scope) {
                var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
//                var characters = "ABCDE";
                $scope.xOrdinals = d3.range(characters.length).map(function (d) {
                    return characters.charAt(d)
                });

                $scope.zOrdMinY = 0;
                $scope.zOrdMaxY = 10;

                $scope.donutData = [
                    {
                        s: [1, 2, 3, 4],
                        x: 4,
                        y: 4
                    },
                    {
                        s: [1, 2, 3, 4],
                        x: 7,
                        y: 7
                    }
                ]

                $scope.funct0 = function (d, i) {
                    return d[0];
                }

                $scope.funcSelf = function (d) {
                    return d;
                }

                $scope.zoomBrushOrdinalHorizontal = function (brush) {
                    $scope.$apply(function ($scope) {
                        if (brush.empty()) {
                            $scope.zxOrdinals = $scope.xOrdinals;
                        }
                        else {
                            var e = brush.extent();
                            var xs = brush.x();
                            var push = xs.rangeBand ? xs.rangeBand() / 2 : 0;

                            $scope.zxOrdinals = $scope.xOrdinals.filter(function (d) {
                                var x = xs(d) + push;
                                return e[0] <= x && x <= e[1];
                            });
                        }
                    });
                };

                $scope.segmentdata = [
                    {
                        x1: 3,
                        y1: 3,
                        x2: 7,
                        y2: 7,
                        h: 9,
                        w: 7

                    }
                ]

                $scope.getHeight = function (d) {
                    return d.h;
                }
                $scope.getWidth = function (d) {
                    return d.w;
                }

                $scope.getX = function (d) {
                    return d[0];
                };
                $scope.getY = function (d) {
                    return d[1];
                };
                $scope.getR = function (d) {
                    return (d[0] + d[1]) / 2 + 1;
                };

                function randBetween(start, end) {
                    return Math.round(Math.random() * (end - start)) + start;
                }

                function get5Randoms() {
                    var rtrn = [];
                    for (var i = 0; i < 5; i++) {
                        var r = randBetween(0, 10);
                        while (rtrn.indexOf(r) >= 0) {
                            r = randBetween(0, 10);
                        }
                        rtrn.push(r);
                    }
                    return rtrn;
                }

                function merge(rA, rB) {
                    return rA
                            .map(function (d, i) {
                                return [d, rB[i]];
                            })
                            .sort(function (a, b) {
                                return a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0;
                            });
                }

                $scope.perturbate = function () {
                    $scope.ordinalStack1 = [
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 2)];
                        }),
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 3)];
                        })
                    ];

                    $scope.ordinalStack2 = [
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 2)];
                        }),
                        $scope.xOrdinals.map(function (d) {
                            return [d, randBetween(0, 3)];
                        })
                    ];

                    $scope.ordinalData = $scope.xOrdinals.map(function (d, i) {
                        return [d, ($scope.ordinalStack1[0][i][1] + $scope.ordinalStack1[1][i][1] + $scope.ordinalStack2[0][i][1] + $scope.ordinalStack2[1][i][1]) / 2];
                    });

                    $scope.points = merge(get5Randoms(), get5Randoms());
                    $scope.points2 = merge(get5Randoms(), get5Randoms());
                    $scope.points3 = merge(get5Randoms(), get5Randoms());

                    $scope.lineData = [$scope.points];
                    $scope.lineData2 = [$scope.points2];
                    $scope.lineData3 = [$scope.points3];

                    $scope.xmin = Math.min(d3.min($scope.lineData[0], $scope.getX), d3.min($scope.lineData2[0], $scope.getX), d3.min($scope.lineData3[0], $scope.getX));
                    $scope.xmax = Math.max(d3.max($scope.lineData[0], $scope.getX), d3.max($scope.lineData2[0], $scope.getX), d3.max($scope.lineData3[0], $scope.getX));

                    $scope.ymax = d3.max($scope.lineData[0], $scope.getY) + d3.max($scope.lineData2[0], $scope.getY) + d3.max($scope.lineData3[0], $scope.getY);
                    $scope.ymin = 0;//d3.min($scope.lineData[0], $scope.getY) + d3.min($scope.lineData2[0], $scope.getY) + d3.min($scope.lineData3[0], $scope.getY);

                    var size_of_donut = Math.round(randBetween(1, 10));

                    $scope.donutData = [];
                    for (var i = 0; i < size_of_donut; ++i) {
                        var slices = Math.round(randBetween(1, 20));
                        var d = [];
                        for (var j = 0; j < slices; ++j) {
                            d.push(Math.random());
                        }
                        $scope.donutData.push({
                            x: randBetween(1, 15),
                            y: randBetween(1, 15),
                            s: d
                        })

                    }
                };

                $scope.zoomBrushContinuous = function (brush, controller) {
                    $scope.$apply(function ($scope) {
                        var e = brush.extent();
                        if (e[0][0] === e[1][0] || e[0][1] === e[1][1]) {
                            $scope.zxmin = $scope.xmin;
                            $scope.zxmax = $scope.xmax;
                            $scope.zymin = $scope.ymin;
                            $scope.zymax = $scope.ymax;
                        }
                        else {
                            $scope.zxmin = e[0][0];
                            $scope.zxmax = e[1][0];
                            $scope.zymin = e[0][1];
                            $scope.zymax = e[1][1];
                        }
                    });
                };

                $scope.perturbate();
                $scope.zxmin = $scope.xmin;
                $scope.zxmax = $scope.xmax;
                $scope.zymin = $scope.ymin;
                $scope.zymax = $scope.ymax;
                $scope.zxOrdinals = $scope.xOrdinals;
            });
</script>
</body>
</html>
